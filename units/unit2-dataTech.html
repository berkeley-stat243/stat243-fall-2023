<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Paciorek">
<meta name="dcterms.date" content="2023-08-21">

<title>Statistics 243 Fall 2023 - Data technologies, formats, and structures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../units/unit3-bash.html" rel="next">
<link href="../units/unit1-intro.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Statistics 243 Fall 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../office_hours.html" rel="" target="">
 <span class="menu-text">Office hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-units" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Units</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-units">    
        <li>
    <a class="dropdown-item" href="../units/unit1-intro.html" rel="" target="">
 <span class="dropdown-text">Unit 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit2-dataTech.html" rel="" target="">
 <span class="dropdown-text">Unit 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit3-bash.html" rel="" target="">
 <span class="dropdown-text">Unit 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit4-goodPractices.html" rel="" target="">
 <span class="dropdown-text">Unit 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit5-programming.html" rel="" target="">
 <span class="dropdown-text">Unit 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit6-parallel.html" rel="" target="">
 <span class="dropdown-text">Unit 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit7-bigData.html" rel="" target="">
 <span class="dropdown-text">Unit 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit8-numbers.html" rel="" target="">
 <span class="dropdown-text">Unit 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit9-sim.html" rel="" target="">
 <span class="dropdown-text">Unit 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit10-linalg.html" rel="" target="">
 <span class="dropdown-text">Unit 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/lab0-setup.html" rel="" target="">
 <span class="dropdown-text">Lab 0: Setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab1-submission.html" rel="" target="">
 <span class="dropdown-text">Lab 1: Problem set submission</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab2-testing.html" rel="" target="">
 <span class="dropdown-text">Lab 2: Assertions, Exceptions, and Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3-debugging.html" rel="" target="">
 <span class="dropdown-text">Lab 3: Debugging</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-tos" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">How tos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-tos">    
        <li>
    <a class="dropdown-item" href="../howtos/accessingPython.html" rel="" target="">
 <span class="dropdown-text">Accessing Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingUnixCommandLine.html" rel="" target="">
 <span class="dropdown-text">Accessing the Unix Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/gitInstall.html" rel="" target="">
 <span class="dropdown-text">Installing Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/quartoInstall.html" rel="" target="">
 <span class="dropdown-text">Installing Quarto</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/ps-submission.html" rel="" target="">
 <span class="dropdown-text">Problem Set Submissions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Windows</li>
        <li>
    <a class="dropdown-item" href="../howtos/windowsAndLinux.html" rel="" target="">
 <span class="dropdown-text">Installing the Linux Subsystem on Windows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://edstem.org/us/courses/42474/discussion/" rel="" target="">
 <span class="menu-text">Discussion</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://statistics.berkeley.edu/computing/training/tutorials" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/berkeley-stat243/stat243-fall-2023" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../units/unit2-dataTech.html">Unit 2</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit1-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit2-dataTech.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Unit 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit3-bash.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit4-goodPractices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit5-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit6-parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit7-bigData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 7</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit8-numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 8</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit9-sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 9</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit10-linalg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 10</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-storage-and-file-formats-on-a-computer" id="toc-data-storage-and-file-formats-on-a-computer" class="nav-link active" data-scroll-target="#data-storage-and-file-formats-on-a-computer">1. Data storage and file formats on a computer</a>
  <ul class="collapse">
  <li><a href="#text-and-binary-files" id="toc-text-and-binary-files" class="nav-link" data-scroll-target="#text-and-binary-files">Text and binary files</a></li>
  <li><a href="#common-file-types" id="toc-common-file-types" class="nav-link" data-scroll-target="#common-file-types">Common file types</a></li>
  <li><a href="#csv-vs.-specialized-formats-such-as-parquet" id="toc-csv-vs.-specialized-formats-such-as-parquet" class="nav-link" data-scroll-target="#csv-vs.-specialized-formats-such-as-parquet">CSV vs.&nbsp;specialized formats such as Parquet</a></li>
  </ul></li>
  <li><a href="#reading-data-from-text-files-into-python" id="toc-reading-data-from-text-files-into-python" class="nav-link" data-scroll-target="#reading-data-from-text-files-into-python">2. Reading data from text files into Python</a>
  <ul class="collapse">
  <li><a href="#core-python-functions" id="toc-core-python-functions" class="nav-link" data-scroll-target="#core-python-functions">Core Python functions</a></li>
  <li><a href="#connections" id="toc-connections" class="nav-link" data-scroll-target="#connections">Connections</a></li>
  <li><a href="#file-paths" id="toc-file-paths" class="nav-link" data-scroll-target="#file-paths">File paths</a></li>
  <li><a href="#reading-data-quickly-arrow-and-polars" id="toc-reading-data-quickly-arrow-and-polars" class="nav-link" data-scroll-target="#reading-data-quickly-arrow-and-polars">Reading data quickly: Arrow and Polars</a></li>
  </ul></li>
  <li><a href="#output-from-python" id="toc-output-from-python" class="nav-link" data-scroll-target="#output-from-python">3. Output from Python</a>
  <ul class="collapse">
  <li><a href="#writing-output-to-files" id="toc-writing-output-to-files" class="nav-link" data-scroll-target="#writing-output-to-files">Writing output to files</a></li>
  <li><a href="#formatting-output" id="toc-formatting-output" class="nav-link" data-scroll-target="#formatting-output">Formatting output</a></li>
  </ul></li>
  <li><a href="#webscraping-and-working-with-html-xml-and-json" id="toc-webscraping-and-working-with-html-xml-and-json" class="nav-link" data-scroll-target="#webscraping-and-working-with-html-xml-and-json">4. Webscraping and working with HTML, XML, and JSON</a>
  <ul class="collapse">
  <li><a href="#reading-html" id="toc-reading-html" class="nav-link" data-scroll-target="#reading-html">Reading HTML</a></li>
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml">XML</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json">JSON</a></li>
  <li><a href="#webscraping-and-web-apis" id="toc-webscraping-and-web-apis" class="nav-link" data-scroll-target="#webscraping-and-web-apis">Webscraping and web APIs</a>
  <ul class="collapse">
  <li><a href="#webscraping-ethics-and-best-practices" id="toc-webscraping-ethics-and-best-practices" class="nav-link" data-scroll-target="#webscraping-ethics-and-best-practices">Webscraping ethics and best practices</a></li>
  <li><a href="#what-is-http" id="toc-what-is-http" class="nav-link" data-scroll-target="#what-is-http">What is HTTP?</a></li>
  <li><a href="#apis-rest--and-soap-based-web-services" id="toc-apis-rest--and-soap-based-web-services" class="nav-link" data-scroll-target="#apis-rest--and-soap-based-web-services">APIs: REST- and SOAP-based web services</a></li>
  <li><a href="#http-requests-by-deconstructing-an-undocumented-api" id="toc-http-requests-by-deconstructing-an-undocumented-api" class="nav-link" data-scroll-target="#http-requests-by-deconstructing-an-undocumented-api">HTTP requests by deconstructing an (undocumented) API</a></li>
  <li><a href="#more-details-on-http-requests" id="toc-more-details-on-http-requests" class="nav-link" data-scroll-target="#more-details-on-http-requests">More details on HTTP requests</a></li>
  <li><a href="#packaged-access-to-an-api" id="toc-packaged-access-to-an-api" class="nav-link" data-scroll-target="#packaged-access-to-an-api">Packaged access to an API</a></li>
  <li><a href="#accessing-dynamic-pages" id="toc-accessing-dynamic-pages" class="nav-link" data-scroll-target="#accessing-dynamic-pages">Accessing dynamic pages</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#file-and-string-encodings" id="toc-file-and-string-encodings" class="nav-link" data-scroll-target="#file-and-string-encodings">5. File and string encodings</a></li>
  <li><a href="#data-structures" id="toc-data-structures" class="nav-link" data-scroll-target="#data-structures">6. Data structures</a>
  <ul class="collapse">
  <li><a href="#standard-data-structures-in-python-and-r" id="toc-standard-data-structures-in-python-and-r" class="nav-link" data-scroll-target="#standard-data-structures-in-python-and-r">Standard data structures in Python and R</a></li>
  <li><a href="#other-kinds-of-data-structures" id="toc-other-kinds-of-data-structures" class="nav-link" data-scroll-target="#other-kinds-of-data-structures">Other kinds of data structures</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="unit2-dataTech.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data technologies, formats, and structures</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chris Paciorek </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><a href="./unit2-dataTech.pdf" class="btn btn-primary">PDF</a></p>
<p>References (see <a href="../syllabus">syllabus</a> for links):</p>
<ul>
<li>Adler</li>
<li>Nolan and Temple Lang, XML and Web Technologies for Data Sciences with R.</li>
<li>Murrell, Introduction to Data Technologies.</li>
<li>SCF tutorial: <a href="https://berkeley-scf.github.io/tutorial-databases/">Working with large datasets in SQL, R, and Python</a></li>
</ul>
<p>(Optional) Videos:</p>
<p>There are four videos from 2020 in the bCourses Media Gallery that you can use for reference if you want to:</p>
<ol type="1">
<li>Text files and ASCII</li>
<li>Encodings and UTF-8</li>
<li>HTML</li>
<li>XML and JSON</li>
</ol>
<p>Note that the videos were prepared for a version of the course that used R, so there are some differences from the content in the current version of the unit that reflect translating between R and Python. I’m not sure how helpful they’ll be, but they are available.</p>
<section id="data-storage-and-file-formats-on-a-computer" class="level1">
<h1>1. Data storage and file formats on a computer</h1>
<p>This unit largely covers topics relevant for early on in the data analysis pipeline: getting data, reading data in, writing data out to disk, and webscraping. We’ll focus on doing these manipulations in Python, but the concepts and tools involved are common to other languages, so familarity with these in Python should allow you to pick up other tools easily. The main downside to working with datasets in Python (true for R and most other languages as well) is that the entire dataset resides in memory, so using standard Python tools can be problematic in some cases; we’ll discuss some alternatives later. Python (and similar languages) has the capability to read in a wide variety of file formats.</p>
<section id="text-and-binary-files" class="level2">
<h2 class="anchored" data-anchor-id="text-and-binary-files">Text and binary files</h2>
<p>In general, files can be divided into text files and binary files. In both cases, information is stored as a series of bits. Recall that a bit is a single value in base 2 (i.e., a 0 or a 1), while a byte is 8 bits.</p>
<p>A <strong>text file</strong> is one in which the bits in the file encode individual characters. Note that the characters can include the digit characters 0-9, so one can include numbers in a text file by writing down the digits needed for the number of interest. Examples of text file formats include CSV, XML, HTML, and JSON.</p>
<p>Text files may be simple ASCII files (i.e., files encoded using ASCII) or files in other encodings such as UTF-8, both covered in Section 5. <a href="http://en.wikipedia.org/wiki/ASCII">ASCII</a> files have 8 bits (1 byte) per character and can represent 128 characters (the 52 lower and upper case letters in English, 10 digits, punctuation and a few other things – basically what you see on a standard US keyboard). UTF-8 files have between 1 and 4 bytes per character.</p>
<p>Some text file formats, such as JSON or HTML, are not easily interpretable/manipulable on a line-by-line basis (unlike, e.g., CSV), so they are not as amenable to processing using shell commands.</p>
<p>A <strong>binary file</strong> is one in which the bits in the file encode the information in a custom format and not simply individual characters. Binary formats are not (easily) human readable but can be more space-efficient and faster to work with (because it can allow random access into the data rather than requiring sequential reading). The meaning of the bytes in such files depends on the specific binary format being used and a program that uses the file needs to know how the format represents information. Examples of binary files include netCDF files, Python pickle files, R data (e.g., .Rda) files, , and compiled code files.</p>
<p>Numbers in binary files are usually stored as 8 bytes per number. We’ll discuss this much more in Unit 8.</p>
</section>
<section id="common-file-types" class="level2">
<h2 class="anchored" data-anchor-id="common-file-types">Common file types</h2>
<p>Here are some of the common file types, some of which are text formats and some of which are binary formats.</p>
<ol type="1">
<li><p>‘Flat’ text files: data are often provided as simple text files. Often one has one record or observation per row and each column or field is a different variable or type of information about the record. Such files can either have a fixed number of characters in each field (<em>fixed width format</em>) or a special character (a <em>delimiter</em>) that separates the fields in each row. Common delimiters are tabs, commas, one or more spaces, and the pipe (|). Common file extensions are <code>.txt</code> and <code>.csv</code>. Metadata (information about the data) are often stored in a separate file. CSV files are quite common, but if you have files where the data contain commas, other delimiters might be preferable. Text can be put in quotes in CSV files, and this can allow use of commas within the data. This is difficult to deal with from the command line, but <code>read_table()</code> in Pandas handles this situation.</p>
<ul>
<li>One occasionally tricky difficulty is as follows. If you have a text file created in Windows, the line endings are coded differently than in UNIX. Windows uses a newline (the ASCII character <code>\n</code>) and a carriage return (the ASCII character <code>\r</code>) whereas UNIX uses onlyl a newline in UNIX). There are UNIX utilities (<code>fromdos</code> in Ubuntu, including the SCF Linux machines and <code>dos2unix</code> in other Linux distributions) that can do the necessary conversion. If you see <code>\^M</code> at the end of the lines in a file, that’s the tool you need. Alternatively, if you open a UNIX file in Windows, it may treat all the lines as a single line. You can fix this with <code>todos</code> or <code>unix2dos</code>.</li>
</ul></li>
<li><p>In some contexts, such as textual data and bioinformatics data, the data may be in a text file with one piece of information per row, but without meaningful columns/fields.</p></li>
<li><p>Data may also be in text files in formats designed for data interchange between various languages, in particular XML or JSON. These formats are “self-describing”; namely the metadata is part of the file. The <code>lxml</code> and <code>json</code> packages are useful for reading and writing from these formats. More in Section 4.</p></li>
<li><p>You may be scraping information on the web, so dealing with text files in various formats, including HTML. The <code>requests</code> and <code>BeautifulSoup</code> packages are useful for reading HTML.</p></li>
<li><p>In scientific contexts, netCDF (<code>.nc</code>) (and the related HDF5) are popular format for gridded data that allows for highly-efficient storage and contains the metadata within the file. The basic structure of a netCDF file is that each variable is an array with multiple dimensions (e.g., latitude, longitude, and time), and one can also extract the values of and metadata about each dimension. The <code>netCDF4</code> package in Python nicely handles working with netCDF files.</p></li>
<li><p>Data may already be in a database or in the data storage format of another statistical package (<code>Stata</code>, <code>SAS</code>, <code>SPSS</code>, etc.). The <code>Pandas</code> package in Python has capabilities for importing Stata (<code>read_stata</code>), SPSS (<code>read_spss</code>), and SAS (<code>read_sas</code>) files, among others.</p></li>
<li><p>For Excel, there are capabilities to read an Excel file (see the <code>read_excel</code> function in Pandas), but you can also just go into Excel and export as a CSV file or the like and then read that into Python. In general, it’s best not to pass around data files as Excel or other spreadsheet format files because (1) Excel is proprietary, so someone may not have Excel and the format is subject to change, (2) Excel imposes limits on the number of rows, (3) one can easily manipulate text files such as CSV using UNIX tools, but this is not possible with an Excel file, (4) Excel files often have more than one sheet, graphs, macros, etc., so they’re not a data storage format per se.</p></li>
<li><p>Python can easily interact with databases (SQLite, PostgreSQL, MySQL, Oracle, etc.), querying the database using SQL and returning results to Python. More in the big data unit and in the large datasets tutorial mentioned above.</p></li>
</ol>
</section>
<section id="csv-vs.-specialized-formats-such-as-parquet" class="level2">
<h2 class="anchored" data-anchor-id="csv-vs.-specialized-formats-such-as-parquet">CSV vs.&nbsp;specialized formats such as Parquet</h2>
<p>CSV is a common format (particularly in some disciplines/contexts) and has the advantages of being simple to understand, human readable, and readily manipulable by line-based processing tools such as shell commands. However, it has various disadvantages:</p>
<ul>
<li>storage is by row, which will often mix values of different types;</li>
<li>extra space is taken up by explicitly storing commas and newlines; and</li>
<li>one must search through the document to find a given row or value – e.g., to find the 10th row, we must search for the 9th newline and then read until the 10th newline.</li>
</ul>
<p>A popular file format that has some advantages over plain text formats such as CSV is <a href="https://parquet.apache.org/docs/overview/motivation/">Parquet</a>. The storage is by column (actually in chunks of columns). This works well with how datasets are often structured in that a given field/variable will generally have values of all the same type and there may be many repeated values, so there are opportunities for efficient storage including compression. Storage by column also allows retrieval only of the columns that a user needs. As a result data stored in the Parquet format often takes up much less space than stored as CSV and can be queried much faster. Also note that data stored in Parquet will often be stored as multiple files.</p>
<p>Here’s a brief exploration using a data file not in the class repository.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Read from CSV</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>t0 <span class="op">=</span> time.time()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data_from_csv <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'airline.csv'</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(time.time() <span class="op">-</span> t0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8521711826324463</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Write out Parquet-formatted data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data_from_csv.to_parquet(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'airline.parquet'</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Read from Parquet</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>t0 <span class="op">=</span> time.time()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data_from_parquet <span class="op">=</span> pd.read_parquet(os.path.join(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'airline.parquet'</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(time.time() <span class="op">-</span> t0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0908823013305664</code></pre>
</div>
</div>
<p>The CSV file is 51 MB while the Parquet file is 8 MB.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"ls"</span>, <span class="st">"-l"</span>, os.path.join(<span class="st">".."</span>, <span class="st">"data"</span>, <span class="st">"airline.csv"</span>)])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"ls"</span>, <span class="st">"-l"</span>, os.path.join(<span class="st">".."</span>, <span class="st">"data"</span>, <span class="st">"airline.parquet"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-rw-r--r-- 1 paciorek scfstaff 51480244 Aug 29  2022 ../data/airline.csv</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>CompletedProcess(args=['ls', '-l', '../data/airline.csv'], returncode=0)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-rw-r--r-- 1 paciorek scfstaff 8153160 Aug 21 13:38 ../data/airline.parquet</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>CompletedProcess(args=['ls', '-l', '../data/airline.parquet'], returncode=0)</code></pre>
</div>
</div>
</section>
</section>
<section id="reading-data-from-text-files-into-python" class="level1">
<h1>2. Reading data from text files into Python</h1>
<section id="core-python-functions" class="level2">
<h2 class="anchored" data-anchor-id="core-python-functions">Core Python functions</h2>
<p>The <code>read_table</code> and <code>read_csv</code> functions in the Pandas package are commonly used for reading in data. They read in delimited files (CSV specifically in the latter case). The key arguments are the delimiter (the <code>sep</code> argument) and whether the file contains a header, a line with the variable names. We can use <code>read_fwf()</code> to read from a fixed width text file into a data frame.</p>
<p>The most difficult part of reading in such files can be dealing with how Pandas determines the types of the fields that are read in. While Pandas will try to determine the types automatically, it can be safer (and faster) to tell Pandas what the types are, using the <code>dtype</code> argument to <code>read_table()</code>.</p>
<p>Let’s work through a couple examples. Before we do that, let’s look at the arguments to <code>read_table</code>. Note that <code>sep=''</code> can use regular expressions (which would be helpful if you want to separate on any amount of white space, as one example).</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_table(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'RTADataSub.csv'</span>),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                    sep <span class="op">=</span> <span class="st">','</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dat.dtypes.head()   <span class="co"># 'object' is string or mixed type</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dat.loc[<span class="dv">0</span>,<span class="dv">1</span>]     </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dat.loc[<span class="dv">0</span>,<span class="dv">1</span>]) <span class="co"># string!</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Whoops, there is an 'x', presumably indicating missingness:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>dat.loc[:,<span class="dv">1</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/linux/mambaforge-3.11/lib/python3.11/site-packages/IPython/core/formatters.py:342: FutureWarning:

In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">

</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>'2336'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>str</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>array(['2336', '2124', '1830', '1833', '1600', '1578', '1187', '1005',
       '918', '865', '871', '860', '883', '897', '898', '893', '913',
       '870', '962', '880', '875', '884', '894', '836', '848', '885',
       '851', '900', '861', '866', '867', '829', '853', '920', '877',
       '908', '855', '845', '859', '856', '825', '828', '854', '847',
       '840', '873', '822', '818', '838', '815', '813', '816', '849',
       '802', '805', '792', '823', '808', '798', '800', '842', '809',
       '807', '826', '810', '801', '794', '771', '796', '790', '787',
       '775', '751', '783', '811', '768', '779', '795', '770', '821',
       '830', '767', '772', '791', '781', '773', '777', '814', '778',
       '782', '837', '759', '846', '797', '835', '832', '793', '803',
       '834', '785', '831', '820', '812', '824', '728', '760', '762',
       '753', '758', '764', '741', '709', '735', '749', '752', '761',
       '750', '776', '766', '789', '763', '864', '858', '869', '886',
       '844', '863', '916', '890', '872', '907', '926', '935', '933',
       '906', '905', '912', '972', '996', '1009', '961', '952', '981',
       '917', '1011', '1071', '1920', '3245', '3805', '3926', '3284',
       '2700', '2347', '2078', '2935', '3040', '1860', '1437', '1512',
       '1720', '1493', '1026', '928', '874', '833', '850', nan, 'x'],
      dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Let's treat 'x' as a missing value indicator.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dat2 <span class="op">=</span> pd.read_table(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'RTADataSub.csv'</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                     sep <span class="op">=</span> <span class="st">','</span>, header <span class="op">=</span> <span class="va">None</span>, na_values <span class="op">=</span> <span class="st">'x'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>dat2.dtypes.head()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>dat2.loc[:,<span class="dv">1</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/linux/mambaforge-3.11/lib/python3.11/site-packages/IPython/core/formatters.py:342: FutureWarning:

In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">

</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>array([2336., 2124., 1830., 1833., 1600., 1578., 1187., 1005.,  918.,
        865.,  871.,  860.,  883.,  897.,  898.,  893.,  913.,  870.,
        962.,  880.,  875.,  884.,  894.,  836.,  848.,  885.,  851.,
        900.,  861.,  866.,  867.,  829.,  853.,  920.,  877.,  908.,
        855.,  845.,  859.,  856.,  825.,  828.,  854.,  847.,  840.,
        873.,  822.,  818.,  838.,  815.,  813.,  816.,  849.,  802.,
        805.,  792.,  823.,  808.,  798.,  800.,  842.,  809.,  807.,
        826.,  810.,  801.,  794.,  771.,  796.,  790.,  787.,  775.,
        751.,  783.,  811.,  768.,  779.,  795.,  770.,  821.,  830.,
        767.,  772.,  791.,  781.,  773.,  777.,  814.,  778.,  782.,
        837.,  759.,  846.,  797.,  835.,  832.,  793.,  803.,  834.,
        785.,  831.,  820.,  812.,  824.,  728.,  760.,  762.,  753.,
        758.,  764.,  741.,  709.,  735.,  749.,  752.,  761.,  750.,
        776.,  766.,  789.,  763.,  864.,  858.,  869.,  886.,  844.,
        863.,  916.,  890.,  872.,  907.,  926.,  935.,  933.,  906.,
        905.,  912.,  972.,  996., 1009.,  961.,  952.,  981.,  917.,
       1011., 1071., 1920., 3245., 3805., 3926., 3284., 2700., 2347.,
       2078., 2935., 3040., 1860., 1437., 1512., 1720., 1493., 1026.,
        928.,  874.,  833.,  850.,   nan])</code></pre>
</div>
</div>
<p>Using <code>dtype</code> is a good way to control how data are read in.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_table(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'hivSequ.csv'</span>),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                  sep <span class="op">=</span> <span class="st">','</span>, header <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                  dtype <span class="op">=</span> {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'PatientID'</span>: <span class="bu">int</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Resp'</span>: <span class="bu">int</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'PR Seq'</span>: <span class="bu">str</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'RT Seq'</span>: <span class="bu">str</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'VL-t0'</span>: <span class="bu">float</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'CD4-t0'</span>: <span class="bu">int</span>})</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>dat.dtypes</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>dat.loc[<span class="dv">0</span>,<span class="st">'PR Seq'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/linux/mambaforge-3.11/lib/python3.11/site-packages/IPython/core/formatters.py:342: FutureWarning:

In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">

</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>'CCTCAAATCACTCTTTGGCAACGACCCCTCGTCCCAATAAGGATAGGGGGGCAACTAAAGGAAGCYCTATTAGATACAGGAGCAGATGATACAGTATTAGAAGACATGGAGTTGCCAGGAAGATGGAAACCAAAAATGATAGGGGGAATTGGAGGTTTTATCAAAGTAARACAGTATGATCAGRTACCCATAGAAATCTATGGACATAAAGCTGTAGGTACAGTATTAATAGGACCTACACCTGTCAACATAATTGGAAGAAATCTGTTGACTCAGCTTGGTTGCACTTTAAATTTY'</code></pre>
</div>
</div>
<p>Note that you can avoid reading in one or more columns by using the <code>usecols</code> argument. Also, specifying the <code>dtype</code> argument explicitly should make for faster file reading.</p>
<p>If possible, it’s a good idea to look through the input file in the shell or in an editor before reading into Python to catch such issues in advance. Using the UNIX command <code>less</code> on <code>RTADataSub.csv</code> would have revealed these various issues, but note that <code>RTADataSub.csv</code> is a 1000-line subset of a much larger file of data available from the kaggle.com website. So more sophisticated use of UNIX utilities (as we will see in Unit 3) is often useful before trying to read something into a program.</p>
<p>If the file is not nicely arranged by field (e.g., if it has ragged lines), we’ll need to do some more work. We can read each line as a separate string, after which we can process the lines using text manipulation. Here’s an example from some US meteorological data where I know from metadata (not provided here) that the 4-11th values are an identifier, the 17-20th are the year, the 22-23rd the month, etc.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'precip.txt'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>     lines <span class="op">=</span> <span class="bu">file</span>.readlines()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> [line[<span class="dv">3</span>:<span class="dv">11</span>] <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> [<span class="bu">int</span>(line[<span class="dv">17</span>:<span class="dv">21</span>]) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> [<span class="bu">int</span>(line[<span class="dv">21</span>:<span class="dv">23</span>]) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>nvalues <span class="op">=</span> [<span class="bu">int</span>(line[<span class="dv">27</span>:<span class="dv">30</span>]) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>year[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>[2010, 2010, 2010, 2010, 2010]</code></pre>
</div>
</div>
<p>Actually, that file, <code>precip.txt</code>, is in a fixed-width format (i.e., every element in a given column has the exact same number of characters),so reading in using <code>pandas.read_fwf()</code> would be a good strategy.</p>
</section>
<section id="connections" class="level2">
<h2 class="anchored" data-anchor-id="connections">Connections</h2>
<p>Python allows you to read in not just from a file but from a more general construct called a <em>connection</em>. This can include reading in text from the output of running a shell command and from unzipping a file on the fly.</p>
<p>Here are some examples of connections:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">'dat.csv.gz'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>     lines <span class="op">=</span> <span class="bu">file</span>.readlines()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zipfile.ZipFile(<span class="st">'dat.zip'</span>, <span class="st">'r'</span>) <span class="im">as</span> archive:</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>     <span class="cf">with</span> archive.<span class="bu">open</span>(<span class="st">'data.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>          lines <span class="op">=</span> <span class="bu">file</span>.readlines()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>command <span class="op">=</span> <span class="st">"ls -al"</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> subprocess.check_output(command, shell <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># `output` is a sequence of bytes.</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> io.BytesIO(output) <span class="im">as</span> stream:  <span class="co"># Create a file-like object.</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> stream.readlines()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://download.bls.gov/pub/time.series/cu/cu.item"</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If a file is large, we may want to read it in in chunks (of lines), do some computations to reduce the size of things, and iterate. This is referred to as online processing, streaming, or chunking, and can be done <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-chunking">using Pandas</a> (among other tools).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'RTADataSub.csv'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>chunksize <span class="op">=</span> <span class="dv">50</span> <span class="co"># Obviously this would be much larger in any real application.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.read_csv(file_path, chunksize <span class="op">=</span> chunksize) <span class="im">as</span> reader:</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> chunk <span class="kw">in</span> reader:</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>         <span class="co"># manipulate the lines and store the key stuff</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f'Read </span><span class="sc">{</span><span class="bu">len</span>(chunk)<span class="sc">}</span><span class="ss"> rows.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>More details on sequential (on-line) processing of large files can be found in the tutorial on large datasets mentioned in the reference list above.</p>
<p>One cool trick that can come in handy is to ‘read’ from a string as if it were a text file. Here’s an example:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'precip.txt'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>     text <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>stringIOtext <span class="op">=</span> io.StringIO(text)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_fwf(stringIOtext, header <span class="op">=</span> <span class="va">None</span>, widths <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create connections for writing output too. Just make sure to open the connection first.</p>
</section>
<section id="file-paths" class="level2">
<h2 class="anchored" data-anchor-id="file-paths">File paths</h2>
<p>A few notes on file paths, related to ideas of reproducibility.</p>
<ol type="1">
<li><p>In general, you don’t want to hard-code absolute paths into your code files because those absolute paths won’t be available on the machines of anyone you share the code with. Instead, use paths relative to the directory the code file is in, or relative to a baseline directory for the project, e.g.:<br>
</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(<span class="st">'../data/cpds.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Using UNIX style directory separators will work in Windows, Mac or Linux, but using Windows style separators is not portable across operating systems.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">## good: will work on Windows</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(<span class="st">'../data/cpds.csv'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">## bad: won't work on Mac or Linux</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(<span class="st">'..\data\cpds.csv'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Even better, use <code>os.path.join</code> so that paths are constructed specifically for the operating system the user is using:<br>
</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">## good: operating-system independent</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'cpds.csv'</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</section>
<section id="reading-data-quickly-arrow-and-polars" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-quickly-arrow-and-polars">Reading data quickly: Arrow and Polars</h2>
<p>Apache Arrow provides efficient data structures for working with data in memory, usable in Python via the PyArrow package. Data are stored by column, with values in a column stored sequentially and in such a way that one can access a specific value without reading the other values in the column (O(1) lookup). Arrow is designed to read data from various file formats, including Parquet, native Arrow format, and text files. In general Arrow will only read data from disk as needed, avoiding keeping the entire dataset in memory.</p>
<p>Other options for avoiding reading all your data into memory include the Dask package and using <code>numpy.load</code> with the <code>mmap_mode</code> argument.</p>
<p><code>polars</code> is designed to be a faster alternative to Pandas for working with data in-memory.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>t0 <span class="op">=</span> time.time()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'airline.csv'</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> time.time()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>dat2 <span class="op">=</span> polars.read_csv(os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'airline.csv'</span>), null_values <span class="op">=</span> [<span class="st">'NA'</span>])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> time.time()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Timing for Pandas: </span><span class="sc">{</span>t1<span class="op">-</span>t0<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Timing for Polars: </span><span class="sc">{</span>t2<span class="op">-</span>t1<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Timing for Pandas: 0.8440947532653809.
Timing for Polars: 0.11989426612854004.</code></pre>
</div>
</div>
</section>
</section>
<section id="output-from-python" class="level1">
<h1>3. Output from Python</h1>
<section id="writing-output-to-files" class="level2">
<h2 class="anchored" data-anchor-id="writing-output-to-files">Writing output to files</h2>
<p>Functions for text output are generally analogous to those for input.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(<span class="st">'/tmp'</span>, <span class="st">'tmp.txt'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'w'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>     <span class="bu">file</span>.writelines(lines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use <code>file.write()</code> to write individual strings.</p>
<p>In Pandas, we can use <code>DataFrame.to_csv</code> and <code>DataFrame.to_parquet</code>.</p>
<p>We can use the <code>json.dump</code> function to output appropriate data objects (e.g., dictionaries or possibly lists) as JSON. One use of JSON as output from Python would be to ‘serialize’ the information in an Python object such that it could be read into another program.</p>
<p>And of course you can always save to a Pickle data file (a binary file format) using <code>pickle.dump()</code> and <code>pickle.load()</code> from the <code>pickle</code> package. Happily this is platform-independent so can be used to transfer Python objects between different OS.</p>
</section>
<section id="formatting-output" class="level2">
<h2 class="anchored" data-anchor-id="formatting-output">Formatting output</h2>
<p>We can use <a href="https://docs.python.org/3/library/string.html#formatstrings">string formatting</a> to control how output is printed to the screen.</p>
<p>The mini-language involved in the format specification can get fairly involved, but a few basic pieces of syntax can do most of what one generally needs to do.</p>
<p>We can format numbers to chosen number of digits and decimal places and handle alignment, using the <code>format</code> method of the string class.</p>
<p>For example:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">'{:&gt;10}'</span>.<span class="bu">format</span>(<span class="fl">3.5</span>)    <span class="co"># right-aligned, using 10 characters</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">'{:.10f}'</span>.<span class="bu">format</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)   <span class="co"># force 10 decimal places</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">'{:15.10f}'</span>.<span class="bu">format</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="co"># force 15 characters, with 10 decimal places</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">format</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="st">'15.10f'</span>) <span class="co"># alternative using a function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'       3.5'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'0.3333333333'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'   0.3333333333'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'   0.3333333333'</code></pre>
</div>
</div>
<p>We can also “interpolate” variables into strings.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">"The number pi is {}."</span>.<span class="bu">format</span>(np.pi)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">"The number pi is {:.5f}."</span>.<span class="bu">format</span>(np.pi)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">"The number pi is {:.12f}."</span>.<span class="bu">format</span>(np.pi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>'The number pi is 3.141592653589793.'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>'The number pi is 3.14159.'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>'The number pi is 3.141592653590.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>val1 <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>val2 <span class="op">=</span> <span class="fl">2.5</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># As of Python 3.6, put the variable names in directly.</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Let's add </span><span class="sc">{</span>val1<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>val2<span class="sc">}</span><span class="ss">."</span>)  </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>num1 <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Let's add the </span><span class="sc">%s</span><span class="st"> numbers </span><span class="sc">%.5f</span><span class="st"> and </span><span class="sc">%15.7f</span><span class="st">."</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>       <span class="op">%</span>(<span class="st">'floating point'</span>, num1 ,<span class="dv">32</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Let's add 1.5 and 2.5.
Let's add the floating point numbers 0.33333 and      32.1428571.</code></pre>
</div>
</div>
<p>Or to insert into a file:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(<span class="st">'/tmp'</span>, <span class="st">'tmp.txt'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'a'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>     <span class="bu">file</span>.write(<span class="st">"Let's add the </span><span class="sc">%s</span><span class="st"> numbers </span><span class="sc">%.5f</span><span class="st"> and </span><span class="sc">%15.7f</span><span class="st">."</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span>(<span class="st">'floating point'</span>, num1 ,<span class="dv">32</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>round</code> is another option, but it’s often better to directly control the printing format.</p>
</section>
</section>
<section id="webscraping-and-working-with-html-xml-and-json" class="level1">
<h1>4. Webscraping and working with HTML, XML, and JSON</h1>
<p>The book <em>XML and Web Technologies for Data Sciences with R</em> by Deb Nolan (UCB Stats faculty) and Duncan Temple Lang (UCB Stats PhD alumnus and UC Davis Stats faculty) provides extensive information about getting and processing data off of the web, including interacting with web services such as REST and SOAP and programmatically handling authentication.</p>
<p>Here are some UNIX command-line tools to help in webscraping and working with files in formats such as JSON, XML, and HTML: <a href="http://jeroenjanssens.com/2013/09/19/seven-command-line-tools-for-data-science.html" class="uri">http://jeroenjanssens.com/2013/09/19/seven-command-line-tools-for-data-science.html</a>.</p>
<p>We’ll cover a few basic examples in this section, but HTML and XML formatting and navigating the structure of such pages in great detail is beyond the scope of what we can cover. The key thing is to see the main concepts and know that the tools exist so that you can learn how to use them if faced with such formats.</p>
<section id="reading-html" class="level2">
<h2 class="anchored" data-anchor-id="reading-html">Reading HTML</h2>
<p>HTML (Hypertext Markup Language) is the standard markup language used for displaying content in a web browser. In simple webpages (ignoring the more complicated pages that involve Javascript), what you see in your browser is simply a <em>rendering</em> (by the browser) of a text file containing HTML.</p>
<p>However, instead of rendering the HTML in a browser, we might want to use code to extract information from the HTML.</p>
<p>Let’s see a brief example of reading in HTML tables.</p>
<p>Note that before doing any coding, it can be helpful to look at the raw HTML source code for a given page. We can explore the underlying HTML source in advance of writing our code by looking at the page source directly in the browser (e.g., in Firefox under the 3-lines (hamburger) “open menu” symbol, see <code>Web Developer (or More Tools) -&gt; Page Source</code> and in Chrome <code>View -&gt; Developer -&gt; View Source</code>), or by downloading the webpage and looking at it in an editor, although in some cases (such as the nytimes.com case), what we might see is a lot of JavaScript.</p>
<p>One lesson here is not to write a lot of your own code to do something that someone else has probably already written a package for. We’ll use the <code>BeautifulSoup4</code> package.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup <span class="im">as</span> bs</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population"</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(URL)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> response.content</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a BeautifulSoup object to parse the HTML</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> bs(html, <span class="st">'html.parser'</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>html_tables <span class="op">=</span> soup.find_all(<span class="st">'table'</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>pd_tables <span class="op">=</span> [pd.read_html(<span class="bu">str</span>(tbl))[<span class="dv">0</span>] <span class="cf">for</span> tbl <span class="kw">in</span> html_tables]</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>[x.shape[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> pd_tables]</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>pd_tables[<span class="dv">0</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>[242, 13, 1]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/linux/mambaforge-3.11/lib/python3.11/site-packages/IPython/core/formatters.py:342: FutureWarning:

In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Country / Dependency</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">% of world</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Source (official or from the United Nations)</th>
<th data-quarto-table-cell-role="th">Unnamed: 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>–</td>
<td>World</td>
<td>8055248000</td>
<td>100%</td>
<td>21 Aug 2023</td>
<td>UN projection[3]</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>China</td>
<td>1411750000</td>
<td>NaN</td>
<td>31 Dec 2022</td>
<td>Official estimate[4]</td>
<td>[b]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>India</td>
<td>1392329000</td>
<td>NaN</td>
<td>1 Jul 2023</td>
<td>Official projection[5]</td>
<td>[c]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>United States</td>
<td>335282000</td>
<td>NaN</td>
<td>21 Aug 2023</td>
<td>National population clock[7]</td>
<td>[d]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>Indonesia</td>
<td>277749853</td>
<td>NaN</td>
<td>31 Dec 2022</td>
<td>Official estimate[8]</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Beautiful Soup works by reading in the HTML as text and then parsing it to build up a tree containing the HTML elements. Then one can <a href="https://beautiful-soup-4.readthedocs.io/en/latest/#searching-the-tree">search by HTML tag or attribute</a> for information you want using <code>find_all</code>.</p>
<p>As another example, it’s often useful to be able to extract the hyperlinks in an HTML document. We’ll find the link using <a href="https://www.w3schools.com/cssref/css_selectors.asp">CSS selectors</a>, which allow you to search for elements within HTML:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/by_year"</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(URL)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> bs(response.content, <span class="st">'html.parser'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Approach 1: search for HTML 'a' tags.</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>a_elements <span class="op">=</span> soup.find_all(<span class="st">'a'</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>links1 <span class="op">=</span> [x.get(<span class="st">'href'</span>) <span class="cf">for</span> x <span class="kw">in</span> a_elements]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Approach 2: search for elements with 'href' attribute</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>href_elements <span class="op">=</span> soup.find_all(href <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>links2 <span class="op">=</span> [x.get(<span class="st">'href'</span>) <span class="cf">for</span> x <span class="kw">in</span> href_elements]</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>links2[<span class="dv">0</span>:<span class="dv">9</span>]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># help(bs.find_all)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>['?C=N;O=D',
 '?C=M;O=A',
 '?C=S;O=A',
 '?C=D;O=A',
 '/pub/data/ghcn/daily/',
 '1750.csv.gz',
 '1763.csv.gz',
 '1764.csv.gz',
 '1765.csv.gz']</code></pre>
</div>
</div>
<p>More generally, we may want to read an HTML document, parse it into its components (i.e., the HTML elements), and navigate through the tree structure of the HTML.</p>
<p>Here’s another example of extracting specific components of information from a webpage (results not shown, since headlines will vary from day to day).</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://www.nytimes.com"</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>responseNYT <span class="op">=</span> requests.get(URL)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>soupNYT <span class="op">=</span> bs(responseNYT.content, <span class="st">'html.parser'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>h2_elements <span class="op">=</span> soupNYT.find_all(<span class="st">"h2"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>headlines2 <span class="op">=</span> [x.get_text() <span class="cf">for</span> x <span class="kw">in</span> h2_elements]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>h3_elements <span class="op">=</span> soupNYT.find_all(<span class="st">"h3"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>headlines3 <span class="op">=</span> [x.get_text() <span class="cf">for</span> x <span class="kw">in</span> h3_elements]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next let’s use the <em>XPath</em> language to specify elements rather than CSS selectors. XPath can also be used for navigating through XML documents.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lxml.html</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the BeautifulSoup object to a lxml object</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>lxml_doc <span class="op">=</span> lxml.html.fromstring(<span class="bu">str</span>(soup))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use XPath to select elements</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>a_elements <span class="op">=</span> lxml_doc.xpath(<span class="st">'//a[@href]'</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> [x.get(<span class="st">'href'</span>) <span class="cf">for</span> x <span class="kw">in</span> a_elements]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>links[<span class="dv">0</span>:<span class="dv">9</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>['?C=N;O=D',
 '?C=M;O=A',
 '?C=S;O=A',
 '?C=D;O=A',
 '/pub/data/ghcn/daily/',
 '1750.csv.gz',
 '1763.csv.gz',
 '1764.csv.gz',
 '1765.csv.gz']</code></pre>
</div>
</div>
</section>
<section id="xml" class="level2">
<h2 class="anchored" data-anchor-id="xml">XML</h2>
<p>XML is a markup language used to store data in self-describing (no metadata needed) format, often with a hierarchical structure. It consists of sets of elements (also known as nodes because they generally occur in a hierarchical structure and therefore have parents, children, etc.) with tags that identify/name the elements, with some similarity to HTML. Some examples of the use of XML include serving as the underlying format for Microsoft Office and Google Docs documents and for the KML language used for spatial information in Google Earth.</p>
<p>Here’s a brief example. The book with id attribute <code>bk101</code> is an element; the author of the book is also an element that is a child element of the book. The id attribute allows us to uniquely identify the element.</p>
<pre><code>    &lt;?xml version="1.0"?&gt;
    &lt;catalog&gt;
       &lt;book id="bk101"&gt;
          &lt;author&gt;Gambardella, Matthew&lt;/author&gt;
          &lt;title&gt;XML Developer's Guide&lt;/title&gt;
          &lt;genre&gt;Computer&lt;/genre&gt;
          &lt;price&gt;44.95&lt;/price&gt;
          &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;
          &lt;description&gt;An in-depth look at creating applications with XML.&lt;/description&gt;
       &lt;/book&gt;
       &lt;book id="bk102"&gt;
          &lt;author&gt;Ralls, Kim&lt;/author&gt;
          &lt;title&gt;Midnight Rain&lt;/title&gt;
          &lt;genre&gt;Fantasy&lt;/genre&gt;
          &lt;price&gt;5.95&lt;/price&gt;
          &lt;publish_date&gt;2000-12-16&lt;/publish_date&gt;
         &lt;description&gt;A former architect battles corporate zombies, an evil sorceress, and her own childhood to become queen of the world.&lt;/description&gt;
       &lt;/book&gt;
    &lt;/catalog&gt;</code></pre>
<p>We can read XML documents into Python using various packages, including <code>lxml</code> and then manipulate the resulting structured data object. Here’s an example of working with lending data from the Kiva lending non-profit. You can see the XML format in a browser at <a href="http://api.kivaws.org/v1/loans/newest.xml" class="uri">http://api.kivaws.org/v1/loans/newest.xml</a>.</p>
<p>XML documents have a tree structure with information at nodes. As above with HTML, one can use the <em>XPath</em> language for navigating the tree and finding and extracting information from the node(s) of interest.</p>
<p>Here is some example code for extracting loan info from the Kiva data. We’ll first show the ‘brute force’ approach of working with the data as a list and then the better approach of using XPath.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xmltodict</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://api.kivaws.org/v1/loans/newest.xml"</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(URL)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> xmltodict.parse(response.content)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>data.keys()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'response'</span>].keys()</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'response'</span>][<span class="st">'loans'</span>].keys()</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="st">'response'</span>][<span class="st">'loans'</span>][<span class="st">'loan'</span>])</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'response'</span>][<span class="st">'loans'</span>][<span class="st">'loan'</span>][<span class="dv">2</span>]</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'response'</span>][<span class="st">'loans'</span>][<span class="st">'loan'</span>][<span class="dv">2</span>][<span class="st">'activity'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>dict_keys(['response'])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>dict_keys(['paging', 'loans'])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>dict_keys(['@type', 'loan'])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>20</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>{'id': '2630960',
 'name': 'Indelicia',
 'description': {'languages': {'@type': 'list', 'language': 'en'}},
 'status': 'fundraising',
 'funded_amount': '0',
 'basket_amount': '0',
 'image': {'id': '5242988', 'template_id': '1'},
 'activity': 'Personal Housing Expenses',
 'sector': 'Housing',
 'themes': {'@type': 'list',
  'theme': ['Water and Sanitation', 'Earth Day Campaign']},
 'use': 'to build a sanitary toilet for her family.',
 'location': {'country_code': 'PH',
  'country': 'Philippines',
  'town': 'Bogo, Cebu',
  'geo': {'level': 'town', 'pairs': '11.012829 123.986149', 'type': 'point'}},
 'partner_id': '145',
 'posted_date': '2023-08-21T20:20:11Z',
 'planned_expiration_date': '2023-09-25T20:20:11Z',
 'loan_amount': '200',
 'borrower_count': '1',
 'lender_count': '0',
 'bonus_credit_eligibility': '1',
 'tags': {'@type': 'list',
  'tag': [{'name': '#Parent', 'id': '16'},
   {'name': '#Health and Sanitation', 'id': '27'}]}}</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>'Personal Housing Expenses'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lxml <span class="im">import</span> etree</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>doc <span class="op">=</span> etree.fromstring(response.content)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>loans <span class="op">=</span> doc.xpath(<span class="st">"//loan"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>[loan.xpath(<span class="st">"activity/text()"</span>) <span class="cf">for</span> loan <span class="kw">in</span> loans]</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">## suppose we only want the country locations of the loans (using XPath)</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>[loan.xpath(<span class="st">"location/country/text()"</span>) <span class="cf">for</span> loan <span class="kw">in</span> loans]</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">## or extract the geographic coordinates</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>[loan.xpath(<span class="st">"location/geo/pairs/text()"</span>) <span class="cf">for</span> loan <span class="kw">in</span> loans]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[['Call Center'],
 ['Pigs'],
 ['Personal Housing Expenses'],
 ['Personal Expenses'],
 ['Personal Expenses'],
 ['Personal Housing Expenses'],
 ['Cattle'],
 ['Food Stall'],
 ['Food Market'],
 ['Retail'],
 ['Personal Housing Expenses'],
 ['Personal Housing Expenses'],
 ['Personal Housing Expenses'],
 ['Personal Housing Expenses'],
 ['Personal Housing Expenses'],
 ['Personal Expenses'],
 ['Personal Expenses'],
 ['Personal Housing Expenses'],
 ['Beverages'],
 ['Food Market']]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[['Madagascar'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Tajikistan'],
 ['Uganda'],
 ['Liberia'],
 ['Liberia'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Philippines'],
 ['Sierra Leone'],
 ['Liberia']]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[['-18.87919 47.507906'],
 ['11.012829 123.986149'],
 ['11.012829 123.986149'],
 ['10.243864 123.941552'],
 ['10.243864 123.941552'],
 ['10.243864 123.941552'],
 ['38.128915 69.621456'],
 ['3.469802 31.248329'],
 ['6.266909 -10.711196'],
 ['6.348679 -10.743608'],
 ['10.243864 123.941552'],
 ['10.707582 123.863454'],
 ['10.243864 123.941552'],
 ['10.707582 123.863454'],
 ['10.412129 123.986149'],
 ['10.707582 123.863454'],
 ['10.707582 123.863454'],
 ['10.707582 123.863454'],
 ['7.863215 -11.195717'],
 ['6.266909 -10.711196']]</code></pre>
</div>
</div>
</section>
<section id="json" class="level2">
<h2 class="anchored" data-anchor-id="json">JSON</h2>
<p>JSON files are structured as “attribute-value” pairs (aka “key-value” pairs), often with a hierarchical structure. Here’s a brief example:</p>
<pre><code>    {
      "firstName": "John",
      "lastName": "Smith",
      "isAlive": true,
      "age": 25,
      "address": {
        "streetAddress": "21 2nd Street",
        "city": "New York",
        "state": "NY",
        "postalCode": "10021-3100"
      },
      "phoneNumbers": [
        {
          "type": "home",
          "number": "212 555-1234"
        },
        {
          "type": "office",
          "number": "646 555-4567"
        }
      ],
      "children": [],
      "spouse": null
    }</code></pre>
<p>A set of key-value pairs is a named array and is placed inside braces (squiggly brackets). Note the nestedness of arrays within arrays (e.g., address within the overarching person array and the use of square brackets for unnamed arrays (i.e., vectors of information), as well as the use of different types: character strings, numbers, null, and (not shown) boolean/logical values. JSON and XML can be used in similar ways, but JSON is less <em>verbose</em> than XML.</p>
<p>We can read JSON into Python using the <code>json</code> package. Let’s play again with the Kiva data. The same data that we had worked with in XML format is also available in JSON format: <a href="https://api.kivaws.org/v1/loans/newest.json" class="uri">https://api.kivaws.org/v1/loans/newest.json</a>.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">"https://api.kivaws.org/v1/loans/newest.json"</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(URL)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> json.loads(response.text)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>data.keys()</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data[<span class="st">'loans'</span>])</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'loans'</span>][<span class="dv">0</span>].keys()</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'loans'</span>][<span class="dv">0</span>][<span class="st">'location'</span>][<span class="st">'country'</span>]</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>[loan[<span class="st">'location'</span>][<span class="st">'country'</span>]  <span class="cf">for</span> loan <span class="kw">in</span> data[<span class="st">'loans'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>dict</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>dict_keys(['paging', 'loans'])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>list</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>dict_keys(['id', 'name', 'description', 'status', 'funded_amount', 'basket_amount', 'image', 'activity', 'sector', 'use', 'location', 'partner_id', 'posted_date', 'planned_expiration_date', 'loan_amount', 'borrower_count', 'lender_count', 'bonus_credit_eligibility', 'tags'])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>'Madagascar'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>['Madagascar',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Tajikistan',
 'Uganda',
 'Liberia',
 'Liberia',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Philippines',
 'Sierra Leone',
 'Liberia']</code></pre>
</div>
</div>
<p>One disadvantage of JSON is that it is not set up to deal with missing values, infinity, etc.</p>
</section>
<section id="webscraping-and-web-apis" class="level2">
<h2 class="anchored" data-anchor-id="webscraping-and-web-apis">Webscraping and web APIs</h2>
<p>Here we’ll see some examples of making requests over the Web to get data. We’ll use APIs to systematically query a website for information. Ideally, but not always, the API will be documented. In many cases that simply amounts to making an HTTP GET request, which is done by constructing a URL.</p>
<p>The <code>requests</code> package is useful for a wide variety of such functionality. Note that much of the functionality I describe below is also possible within the shell using either <code>wget</code> or <code>curl</code>.</p>
<section id="webscraping-ethics-and-best-practices" class="level3">
<h3 class="anchored" data-anchor-id="webscraping-ethics-and-best-practices">Webscraping ethics and best practices</h3>
<p>Webscraping is the process of extracting data from the web, either directly from a website or using a web API (application programming interface).</p>
<ol type="1">
<li><p><strong>Should you webscrape?</strong> In general, if we can avoid webscraping (particularly if there is not an API) and instead directly download a data file from a website, that is greatly preferred.</p></li>
<li><p><strong>May you webscrape?</strong> Before you set up any automated downloading of materials/data from the web you should make sure that what you are about to do is consistent with the rules provided by the website.</p></li>
</ol>
<p>Some places to look for information on what the website allows are:</p>
<ul>
<li><p>legal pages such as Terms of Service or Terms and Conditions on the website.</p></li>
<li><p>check the robots.txt file (e.g., <a href="https://scholar.google.com/robots.txt" class="uri">https://scholar.google.com/robots.txt</a>) to see what a web crawler is allowed to do, and whether the site requires a particular delay between requests to the sites</p></li>
<li><p>potentially contact the site owner if you plan to scrape a large amount of data</p></li>
</ul>
<p>Here are some links with useful information:</p>
<ul>
<li><p><a href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01">Blog post on webscraping ethics</a></p></li>
<li><p><a href="https://www.promptcloud.com/blog/how-to-read-and-respect-robots-file">Some information on how to understand a robots.txt file</a></p></li>
</ul>
<p>Tips for when you make automated requests:</p>
<ul>
<li>When debugging code that processes the result of such a request, just run the request once, save (i.e., cache) the result, and then work on the processing code applied to the result. Don’t make the same request over and over again.</li>
<li>In many cases you will want to include a time delay between your automated requests to a site, including if you are not actually crawling a site but just want to automate a small number of queries.</li>
</ul>
</section>
<section id="what-is-http" class="level3">
<h3 class="anchored" data-anchor-id="what-is-http">What is HTTP?</h3>
<p>HTTP (hypertext transfer protocol) is a system for communicating information from a server (i.e., the website of interest) to a client (e.g., your laptop). The client sends a request and the server sends a response.</p>
<p>When you go to a website in a browser, your browser makes an HTTP GET request to the website. Similarly, when we did some downloading of html from webpages above, we used an HTTP GET request.</p>
<p>Anytime the URL you enter includes parameter information after a question mark (<code>www.somewebsite.com?param1=arg1&amp;param2=arg2</code>), you are using an API.</p>
<p>The response to an HTTP request will include a status code, which can be interpreted based on <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">this information</a>.</p>
<p>The response will generally contain content in the form of text (e.g., HTML, XML, JSON) or raw bytes.</p>
</section>
<section id="apis-rest--and-soap-based-web-services" class="level3">
<h3 class="anchored" data-anchor-id="apis-rest--and-soap-based-web-services">APIs: REST- and SOAP-based web services</h3>
<p>Ideally a web service documents their API (Applications Programming Interface) that serves data or allows other interactions. REST and SOAP are popular API standards/styles. Both REST and SOAP use HTTP requests; we’ll focus on REST as it is more common and simpler. When using REST, we access <em>resources</em>, which might be a Facebook account or a database of stock quotes. The API will (hopefully) document what information it expects from the user and will return the result in a standard format (often a particular file format rather than producing a webpage).</p>
<p>Often the format of the request is a URL (aka an endpoint) plus a query string, passed as a GET request. Let’s search for plumbers near Berkeley, and we’ll see the GET request, in the form:</p>
<p><a href="https://www.yelp.com/search?find_desc=plumbers&amp;find_loc=Berkeley+CA&amp;ns=1" class="uri">https://www.yelp.com/search?find_desc=plumbers&amp;find_loc=Berkeley+CA&amp;ns=1</a></p>
<ul>
<li><p>the query string begins with ?</p></li>
<li><p>there are one or more <code>Parameter=Argument</code> pairs</p></li>
<li><p>pairs are separated by &amp;</p></li>
<li><p>+ is used in place of each space</p></li>
</ul>
<p>Let’s see an example of accessing economic data from the World Bank, using the <a href="https://datahelpdesk.worldbank.org/knowledgebase/topics/125589-developer-information">documentation for their API</a>. Following the <a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-api-basic-call-structures">API call structure</a>, we can download (for example), data on various countries. The documentation indicates that our REST-based query can use either a URL structure or an argument-based structure.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Queries based on the documentation</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>api_url <span class="op">=</span> <span class="st">"http://api.worldbank.org/V2/incomeLevel/LIC/country"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>api_args <span class="op">=</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=LIC"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Generalizing a bit</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=MIC&amp;format=json"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># data = json.loads(response.content)</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: debug why above line fails when rendering</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Be careful of data truncation/pagination</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">False</span>:</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=MIC&amp;format=json&amp;per_page=1000"</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> json.loads(response.content)</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">## Programmatic control</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>baseURL <span class="op">=</span> <span class="st">"http://api.worldbank.org/V2/country"</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>group <span class="op">=</span> <span class="st">'MIC'</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="bu">format</span> <span class="op">=</span> <span class="st">'json'</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>args <span class="op">=</span> {<span class="st">'incomeLevel'</span>: group, <span class="st">'format'</span>: <span class="bu">format</span>, <span class="st">'per_page'</span>: <span class="dv">1000</span>}</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> baseURL <span class="op">+</span> <span class="st">'?'</span> <span class="op">+</span> <span class="st">'&amp;'</span>.join([<span class="st">'='</span>.join(</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>                               [key, <span class="bu">str</span>(args[key])]) <span class="cf">for</span> key <span class="kw">in</span> args])</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> json.loads(response.content)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[<span class="dv">1</span>])</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data[<span class="dv">1</span>][<span class="dv">5</span>])</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">1</span>][<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>list</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>108</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>dict</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>{'id': 'BEN',
 'iso2Code': 'BJ',
 'name': 'Benin',
 'region': {'id': 'SSF', 'iso2code': 'ZG', 'value': 'Sub-Saharan Africa '},
 'adminregion': {'id': 'SSA',
  'iso2code': 'ZF',
  'value': 'Sub-Saharan Africa (excluding high income)'},
 'incomeLevel': {'id': 'LMC',
  'iso2code': 'XN',
  'value': 'Lower middle income'},
 'lendingType': {'id': 'IDX', 'iso2code': 'XI', 'value': 'IDA'},
 'capitalCity': 'Porto-Novo',
 'longitude': '2.6323',
 'latitude': '6.4779'}</code></pre>
</div>
</div>
<p>APIs can change and disappear. A few years ago, the example above involved the World Bank’s Climate Data API, which I can no longer find!</p>
<p>As another example, here we can see the <a href="https://fiscaldata.treasury.gov/api-documentation/">US Treasury Department API</a>, which allows us to construct queries for federal financial data.</p>
<p>The Nolan and Temple Lang book provides a number of examples of different ways of authenticating with web services that control access to the service.</p>
<p>Finally, some web services allow us to pass information to the service in addition to just getting data or information. E.g., you can programmatically interact with your Facebook, Dropbox, and Google Drive accounts using REST based on HTTP POST, PUT, and DELETE requests. Authentication is of course important in these contexts and some times you would first authenticate with your login and password and receive a “token”. This token would then be used in subsequent interactions in the same session.</p>
<p>I created your <code>github.berkeley.edu</code> accounts from Python by interacting with the <a href="https://docs.github.com/en/rest/reference/repos">GitHub API</a> using <code>requests</code>.</p>
</section>
<section id="http-requests-by-deconstructing-an-undocumented-api" class="level3">
<h3 class="anchored" data-anchor-id="http-requests-by-deconstructing-an-undocumented-api">HTTP requests by deconstructing an (undocumented) API</h3>
<p>In some cases an API may not be documented or we might be lazy and not use the documentation. Instead we might deconstruct the queries a browser makes and then mimic that behavior, in some cases having to parse HTML output to get at data. Note that if the webpage changes even a little bit, our carefully constructed query syntax may fail.</p>
<p>Let’s look at some UN data (agricultural crop data). By going to<br>
<a href="http://data.un.org/Explorer.aspx?d=FAO" class="uri">http://data.un.org/Explorer.aspx?d=FAO</a>, and clicking on “Crops”, we’ll see a bunch of agricultural products with “View data” links. Click on “apricots” as an example and you’ll see a “Download” button that allows you to download a CSV of the data. Let’s select a range of years and then try to download “by hand”. Sometimes we can right-click on the link that will download the data and directly see the URL that is being accessed and then one can deconstruct it so that you can create URLs programmatically to download the data you want.</p>
<p>In this case, we can’t see the full URL that is being used because there’s some Javascript involved. Therefore, rather than looking at the URL associated with a link we need to view the actual HTTP request sent by our browser to the server. We can do this using features of the browser (e.g., in Firefox see <code>Web Developer -&gt; Network</code> and in Chrome <code>View -&gt; Developer -&gt; Developer tools</code> and choose the <code>Network</code> tab) (or right-click on the webpage and select <code>Inspect</code> and then <code>Network</code>). Based on this we can see that an HTTP GET request is being used with a URL such as:<br>
<a href="http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;s=countryName:asc,elementCode:asc,year:desc" class="uri">http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;s=countryName:asc,elementCode:asc,year:desc</a>.</p>
<p>We’e now able to easily download the data using that URL, which we can fairly easily construct using string processing in bash, Python, or R, such as this (here I just paste it together directly, but using more structured syntax such as I used for the World Bank example would be better):</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">## example URL:</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">## http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">##year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">##s=countryName:asc,elementCode:asc,year:desc</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>itemCode <span class="op">=</span> <span class="dv">526</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>baseURL <span class="op">=</span> <span class="st">"http://data.un.org/Handlers/DownloadHandler.ashx"</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>yrs <span class="op">=</span> <span class="st">','</span>.join([<span class="bu">str</span>(yr) <span class="cf">for</span> yr <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2012</span>,<span class="dv">2018</span>)])</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> <span class="ss">f"?DataFilter=itemCode:</span><span class="sc">{</span>itemCode<span class="sc">}</span><span class="ss">;year:</span><span class="sc">{</span>yrs<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>args1 <span class="op">=</span> <span class="st">"&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,3,4,5,6,7&amp;"</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>args2 <span class="op">=</span> <span class="st">"s=countryName:asc,elementCode:asc,year:desc"</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> baseURL <span class="op">+</span> <span class="bu">filter</span> <span class="op">+</span> args1 <span class="op">+</span> args2</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">## If the website provided a CSV, this would be easier, but it zips the file.</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> io.BytesIO(response.content) <span class="im">as</span> stream:  <span class="co"># create a file-like object</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>     <span class="cf">with</span> zipfile.ZipFile(stream, <span class="st">'r'</span>) <span class="im">as</span> archive:   <span class="co"># treat the object as a zip file</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>          <span class="cf">with</span> archive.<span class="bu">open</span>(archive.filelist[<span class="dv">0</span>].filename, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:  <span class="co"># get a pointer to the embedded file</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>              dat <span class="op">=</span> pd.read_csv(<span class="bu">file</span>)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>dat.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/linux/mambaforge-3.11/lib/python3.11/site-packages/IPython/core/formatters.py:342: FutureWarning:

In future versions `DataFrame.to_latex` is expected to utilise the base implementation of `Styler.to_latex` for formatting and rendering. The arguments signature may therefore change. It is recommended instead to use `DataFrame.style.to_latex` which also contains additional functionality.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country or Area</th>
<th data-quarto-table-cell-role="th">Element Code</th>
<th data-quarto-table-cell-role="th">Element</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Unit</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Value Footnotes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>432</td>
<td>Gross Production Index Number (2014-2016 = 100)</td>
<td>2017.0</td>
<td>index</td>
<td>202.19</td>
<td>Fc</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>432</td>
<td>Gross Production Index Number (2014-2016 = 100)</td>
<td>2016.0</td>
<td>index</td>
<td>27.45</td>
<td>Fc</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>432</td>
<td>Gross Production Index Number (2014-2016 = 100)</td>
<td>2015.0</td>
<td>index</td>
<td>134.50</td>
<td>Fc</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>432</td>
<td>Gross Production Index Number (2014-2016 = 100)</td>
<td>2014.0</td>
<td>index</td>
<td>138.05</td>
<td>Fc</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>432</td>
<td>Gross Production Index Number (2014-2016 = 100)</td>
<td>2013.0</td>
<td>index</td>
<td>138.05</td>
<td>Fc</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>So, what have we achieved?</p>
<ol type="1">
<li><p>We have a reproducible workflow we can share with others (perhaps ourself in the future).</p></li>
<li><p>We can automate the process of downloading many such files.</p></li>
</ol>
</section>
<section id="more-details-on-http-requests" class="level3">
<h3 class="anchored" data-anchor-id="more-details-on-http-requests">More details on HTTP requests</h3>
<p>A more sophisticated way to do the download is to pass the request in a structured way with named input parameters. This request is easier to construct programmatically. Here what is returned is a zip file, which is represented in Python as a sequence of “raw” bytes.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">"DataFilter"</span>: <span class="ss">f"itemCode:</span><span class="sc">{</span>itemCode<span class="sc">}</span><span class="ss">;year:</span><span class="sc">{</span>yrs<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">"DataMartID"</span>: <span class="st">"FAO"</span>, </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Format"</span>: <span class="st">"csv"</span>, </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"c"</span>: <span class="st">"2,3,4,5,6,7"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"s"</span>: <span class="st">"countryName:asc,elementCode:asc,year:desc"</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>       }    </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(baseURL, params <span class="op">=</span> data)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> io.BytesIO(response.content) <span class="im">as</span> stream:  </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>     <span class="cf">with</span> zipfile.ZipFile(stream, <span class="st">'r'</span>) <span class="im">as</span> archive:</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>          <span class="cf">with</span> archive.<span class="bu">open</span>(archive.filelist[<span class="dv">0</span>].filename, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:  </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>              dat <span class="op">=</span> pd.read_csv(<span class="bu">file</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In some cases we may need to send a lot of information as part of the URL in a GET request. If it gets to be too long (e.g,, more than 2048 characters) many web servers will reject the request. Instead we may need to use an HTTP POST request (POST requests are often used for submitting web forms). A typical request would have syntax like this search (using <code>requests</code>):</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'http://www.wormbase.org/db/searches/advanced/dumper'</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {      <span class="st">"specipes"</span>:<span class="st">"briggsae"</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"list"</span>: <span class="st">""</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"flank3"</span>: <span class="st">"0"</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"flank5"</span>: <span class="st">"0"</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"feature"</span>: <span class="st">"Gene Models"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"dump"</span>: <span class="st">"Plain TEXT"</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"orientation"</span>: <span class="st">"Relative to feature"</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"relative"</span>: <span class="st">"Chromsome"</span>,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"DNA"</span>:<span class="st">"flanking sequences only"</span>,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">".cgifields"</span> :  <span class="st">"feature, orientation, DNA, dump, relative"</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>}                                  </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.post(url, data <span class="op">=</span> data)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"POST request successful"</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"POST request failed with status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately that specific search doesn’t work because the server URL and/or API seem to have changed. But it gives you an idea of what the format would look like.</p>
<p><code>requests</code> can handle other kinds of HTTP requests such as PUT and DELETE. Finally, some websites use cookies to keep track of users, and you may need to download a cookie in the first interaction with the HTTP server and then send that cookie with later interactions. More details are available in the Nolan and Temple Lang book.</p>
</section>
<section id="packaged-access-to-an-api" class="level3">
<h3 class="anchored" data-anchor-id="packaged-access-to-an-api">Packaged access to an API</h3>
<p>For popular websites/data sources, a developer may have packaged up the API calls in a user-friendly fashion for use from Python, R, or other software. For example there are Python (twitter) and R (twitteR) packages for interfacing with Twitter via its API.</p>
<p>Here’s some example code for Python. This looks up the US senators’ Twitter names and then downloads a portion of each of their timelines, i.e., the time series of their tweets. Note that Twitter has limits on how much one can download at once.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> twitter</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You will need to set the following variables with your</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># personal information.  To do this you will need to create</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a personal account on Twitter (if you don't already have</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># one).  Once you've created an account, create a new</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co"># application here:</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    https://dev.twitter.com/apps</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co"># You can manage your applications here:</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    https://apps.twitter.com/</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Select your application and then under the section labeled</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co"># "Key and Access Tokens", you will find the information needed</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co"># below.  Keep this information private.</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>CONSUMER_KEY       <span class="op">=</span> <span class="st">""</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>CONSUMER_SECRET    <span class="op">=</span> <span class="st">""</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>OAUTH_TOKEN        <span class="op">=</span> <span class="st">""</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>OAUTH_TOKEN_SECRET <span class="op">=</span> <span class="st">""</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> twitter.oauth.OAuth(OAUTH_TOKEN, OAUTH_TOKEN_SECRET,</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>                           CONSUMER_KEY, CONSUMER_SECRET)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> twitter.Twitter(auth<span class="op">=</span>auth)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="co"># get the list of senators</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>senators <span class="op">=</span> api.lists.members(owner_screen_name<span class="op">=</span><span class="st">"gov"</span>,</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>                             slug<span class="op">=</span><span class="st">"us-senate"</span>, count<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="co"># get all the senators' timelines</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [d[<span class="st">"screen_name"</span>] <span class="cf">for</span> d <span class="kw">in</span> senators[<span class="st">"users"</span>]]</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>timelines <span class="op">=</span> [api.statuses.user_timeline(screen_name<span class="op">=</span>name, count <span class="op">=</span> <span class="dv">500</span>) </span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> name <span class="kw">in</span> names]</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="co"># save information out to JSON</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"senators-list.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>    json.dump(senators, f, indent<span class="op">=</span><span class="dv">4</span>, sort_keys<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"timelines.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>    json.dump(timelines, f, indent<span class="op">=</span><span class="dv">4</span>, sort_keys<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="accessing-dynamic-pages" class="level3">
<h3 class="anchored" data-anchor-id="accessing-dynamic-pages">Accessing dynamic pages</h3>
<p>Some websites dynamically change in reaction to the user behavior. In these cases you need a tool that can mimic the behavior of a human interacting with a site. Some options are:</p>
<ul>
<li><code>selenium</code> is a popular tool for doing this, and there is a Python package of the same name.</li>
<li>Using <code>scrapy</code> plus <code>splash</code> is another approach.</li>
</ul>
</section>
</section>
</section>
<section id="file-and-string-encodings" class="level1">
<h1>5. File and string encodings</h1>
<p>Text (either in the form of a file with regular language in it or a data file with fields of character strings) will often contain characters that are not part of the <a href="http://en.wikipedia.org/wiki/ASCII">limited ASCII set of characters</a>, which has <span class="math inline">\(2^{7}=128\)</span> characters and control codes; basically what you see on a standard US keyboard. Each character takes up one byte (8 bits) of space (there is an unused bit that comes in handy in the UTF-8 context). We can actually hand-generate an ASCII file using the binary representation of each character in Python as an illustration.</p>
<p>The letter “M” is encoded based on the ASCII standard in bits as “01001101” as seen in the link above. For convenience, this is often written as two base-16 numbers (i.e., hexadecimal), where “0100”=“4” and “1101”=“d”, hence we have “4d” in hexadecimal.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 4d in hexadecimal is 'M'</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 0a is a newline (at least in Linux/Mac)</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">## "0x" is how we tell Python we are using hexadecimal</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>[<span class="bu">hex</span>(<span class="bu">ord</span>(x)) <span class="cf">for</span> x <span class="kw">in</span> [<span class="st">'M'</span>,<span class="st">'o'</span>,<span class="st">'m'</span>,<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>]] <span class="co">## i.e., "Mom\n" in ascii</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>hexvals <span class="op">=</span> <span class="st">b'</span><span class="ch">\x4d\x6f\x6d\x0a</span><span class="st">'</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'tmp.txt'</span>, <span class="st">'wb'</span>) <span class="im">as</span> textfile:</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>     nbytes <span class="op">=</span> textfile.write(hexvals)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>nbytes</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"ls"</span>, <span class="st">"-l"</span>, <span class="st">"tmp.txt"</span>])</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'tmp.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> textfile:</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>     line <span class="op">=</span> textfile.readlines()</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>line</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>['0x4d', '0x6f', '0x6d', '0xa']</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-rw-r--r-- 1 paciorek scfstaff 4 Aug 21 13:38 tmp.txt</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>CompletedProcess(args=['ls', '-l', 'tmp.txt'], returncode=0)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>['Mom\n']</code></pre>
</div>
</div>
<p>When encountering non-ASCII files, in some cases you may need to deal with the text encoding (the mapping of individual characters (including tabs, returns, etc.) to a set of numeric codes). There are a variety of different encodings for text files, with different ones common on different operating systems. <a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> is an encoding for the Unicode characters that includes more than 110,000 characters from 100 different alphabets/scripts. It’s widely used on the web. Latin-1 encodes a small subset of Unicode and contains the characters used in many European languages (e.g., letters with accents). Here’s an example of using a non-ASCII Unicode character:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">## n-tilde and division symbol as Unicode 'code points'</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Python `str` type stores Unicode characters.</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>x2_unicode <span class="op">=</span> <span class="st">'Pe</span><span class="ch">\u00f1</span><span class="st">a 3</span><span class="ch">\u00f7</span><span class="st">2'</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>x2_unicode</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(x2_unicode)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="bu">bytes</span>(<span class="st">'</span><span class="ch">\u00f1</span><span class="st">'</span>, <span class="st">'utf-8'</span>)    <span class="co"># indeed - two bytes, not one</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="bu">bytes</span>(<span class="st">'</span><span class="ch">\u00f7</span><span class="st">'</span>, <span class="st">'utf-8'</span>)    <span class="co"># indeed - two bytes, not one</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">## specified directly as hexadecimal in UTF-8 encoding </span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>x2_utf8 <span class="op">=</span> <span class="st">b'Pe</span><span class="ch">\xc3\xb1</span><span class="st">a 3</span><span class="ch">\xc3\xb7</span><span class="st">2'</span> </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>x2_utf8</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'tmp2.txt'</span>, <span class="st">'wb'</span>) <span class="im">as</span> textfile:</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>     nbytes <span class="op">=</span> textfile.write(x2_utf8)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co">## Here n-tilde and division symbol take up two bytes</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"ls"</span>, <span class="st">"-l"</span>, <span class="st">"tmp2.txt"</span>])</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="co">## The system knows how to interpret the UTF-8 encoded file</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="co">## and represent the Unicode character on the screen:</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"cat"</span>, <span class="st">"tmp2.txt"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>'Peña 3÷2'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>str</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>b'\xc3\xb1'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>b'\xc3\xb7'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>b'Pe\xc3\xb1a 3\xc3\xb72'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-rw-r--r-- 1 paciorek scfstaff 10 Aug 21 13:38 tmp2.txt</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>CompletedProcess(args=['ls', '-l', 'tmp2.txt'], returncode=0)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Peña 3÷2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>CompletedProcess(args=['cat', 'tmp2.txt'], returncode=0)</code></pre>
</div>
</div>
<p>UTF-8 is cleverly designed in terms of the bit-wise representation of characters such that ASCII characters still take up one byte, and most other characters take two bytes, but some take four bytes. In fact it is even more clever than that - the representation is such that the bits of a one-byte character never appear within the representation of a two- or three- or four-byte character (and similarly for two-byte characters in three- or four-byte characters, etc.).</p>
<p>The UNIX utility <code>file</code>, e.g.&nbsp;<code>file tmp.txt</code> can help provide some information.</p>
<p>Various Python functions such as <code>readlines</code> allow one to specify the encoding as one reads text in. The UNIX utility <code>iconv</code> and the Python function <code>encode</code> can help with conversions.</p>
<p>The default encoding in Python is UTF-8; note below that various types of information are interpreted in US English with the encoding UTF-8:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> locale</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>locale.getlocale()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>('en_US', 'UTF-8')</code></pre>
</div>
</div>
<p>With strings already in Python, you can convert between encodings with the <code>encode</code> method for string objects:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"Melhore sua seguran</span><span class="ch">\xe7</span><span class="st">a"</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>text  <span class="co"># automatically encoded as UTF-8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>'Melhore sua segurança'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>text.encode(<span class="st">'latin1'</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>text  </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    text.encode(<span class="st">'ascii'</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> error:</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(error)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>b'Melhore sua seguran\xe7a'</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'Melhore sua segurança'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>'ascii' codec can't encode character '\xe7' in position 19: ordinal not in range(128)</code></pre>
</div>
</div>
<p>An error message about decoding/invalid bytes in the message often indicates an encoding issue. In particular errors may arise when trying to do read or manipulate strings in Python for which the encoding is not properly set. Here’s an example with some Internet logging data that we used a few years ago in class in a problem set and which caused some problems.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'file.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> textfile:</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> textfile.readlines()</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> error:</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(error)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'file.txt'</span>, <span class="st">'r'</span>, encoding <span class="op">=</span> <span class="st">'latin1'</span>) <span class="im">as</span> textfile:</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> textfile.readlines()</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Note the non-ASCII (Latin-1) character (the upside-down question mark)</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>lines[<span class="dv">16925</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'utf-8' codec can't decode byte 0xac in position 7922: invalid start byte</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>'from 5#c¿a7lw8lz2nX,%@ [128.32.244.179] by ncpc-email with ESMTP\n'</code></pre>
</div>
</div>
</section>
<section id="data-structures" class="level1">
<h1>6. Data structures</h1>
<p>As we’re reading data into Python or other languages, it’s important to think about the data structures we’ll use to store the information. The data structure we choose can affect:</p>
<ul>
<li>the amount of memory we need,</li>
<li>how quickly we can access the information in the data structure,</li>
<li>how much copying needs to be done to add information to or remove information from the data structure,</li>
<li>how efficiently we can use the data in subsequent computations.</li>
</ul>
<p>This means that what you plan to do with the data should guide what kind of structure you store the data in.</p>
<section id="standard-data-structures-in-python-and-r" class="level2">
<h2 class="anchored" data-anchor-id="standard-data-structures-in-python-and-r">Standard data structures in Python and R</h2>
<ul>
<li>In Python and R, one often ends up working with dataframes, lists, and arrays/vectors/matrices/tensors.</li>
<li>In Python we commonly work with data structures that are part of additional packages, in particular numpy arrays and pandas dataframes.</li>
<li>Dictionaries in Python allow for easy use of key-value pairs where one can access values based on their key/label. In R one can do something similar with named vectors or named lists or (more efficiently) by using environments.</li>
<li>In R, if we are not working with rectangular datasets or standard numerical objects, we often end up using lists or enhanced versions of lists, sometimes with deeply nested structures.</li>
</ul>
<p>In Unit 7, we’ll talk about <em>distributed</em> data structures that allow one to easily work with data distributed across multiple computers.</p>
</section>
<section id="other-kinds-of-data-structures" class="level2">
<h2 class="anchored" data-anchor-id="other-kinds-of-data-structures">Other kinds of data structures</h2>
<p>You may have heard of various other kinds of data structures, such as linked lists, trees, graphs, queues, and stacks. One of the key aspects that differentiate such data structures is how one navigates through the elements.</p>
<p><em>Sets</em> are collections of elements that don’t have any duplicates (like a mathematical set).</p>
<p>With a <em>linked list</em>, with each element (or node) has a value and a pointer (reference) to the location of the next element. (With a doubly-linked list, there is also a pointer back to the previous element.) One big advantage of this is that one can insert an element by simply modifying the pointers involved at the site of the insertion, without copying any of the other elements in the list. A big disadvantage is that to get to an element you have to navigate through the list.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="linked-list.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Linked list (courtesy of computersciencewiki.org)</figcaption>
</figure>
</div>
<p>Both <em>trees</em> and <em>graphs</em> are collections of nodes (vertices) and links (edges). A tree involves a set of nodes and links to child nodes (also possibly containing information linking the child nodes to their parent nodes). With a graph, the links might not be directional, and there can be cycles.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tree.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Tree (courtesy of computersciencewiki.org)</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="graph.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Graph (courtesy of computersciencewiki.org)</figcaption>
</figure>
</div>
<p>A <em>stack</em> is a collection of elements that behave like a stack of lunch trays. You can only access the top element directly(“last in, first out”), so the operations are that you can push a new element onto the stack or pop the top element off the stack. In fact, nested function calls behave as stacks, and the memory used in the process of evaluating the function calls is called the ‘stack’.</p>
<p>A <em>queue</em> is like the line at a grocery store, behaving as “first in, first out”.</p>
<p>One can use such data structures either directly or via add-on packages in Python and R, though I don’t think they’re all that commonly used in R. This is probably because statistical/data science/machine learning workflows often involve either ‘rectangular’ data (i.e., dataframe-style data) and/or mathematical computations with arrays. That said, trees and graphs are widely used.</p>
<p>Some related concepts that we’ll discuss further in Unit 5 include:</p>
<ul>
<li>types: this refers to how a given piece of information is stored and what operations can be done with the information.
<ul>
<li>‘primitive’ types are the most basic types that often relate directly to how data are stored in memory or on disk (e.g., booleans, integers, numeric (real-valued), character, pointer (address, reference).</li>
</ul></li>
<li>pointers: references to other locations (addresses) in memory. One often uses pointers to avoid unnecessary copying of data.</li>
<li>hashes: hashing involves fast lookup of the value associated with a key (a label), using a hash function, which allows one to convert the key to an address. This avoids having to find the value associated with a specific key by looking through all the keys until the key of interest is found (an O(n) operation).</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../units/unit1-intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Unit 1</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../units/unit3-bash.html" class="pagination-link">
        <span class="nav-page-text">Unit 3</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>